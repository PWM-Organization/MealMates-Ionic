<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button (click)="goToLanding()"></ion-back-button>
    </ion-buttons>
    <ion-title>Crear Cuenta</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="auth-content">
  <!-- Hero Section with Gradient -->
  <div class="hero-section">
    <div class="hero-content">
      <div class="logo-container">
        <ion-icon name="restaurant-outline" class="logo-icon"></ion-icon>
        <h1>MealMates</h1>
      </div>
      <p class="hero-subtitle">¡Únete a nuestra comunidad!</p>
    </div>
  </div>

  <!-- Register Form Section -->
  <div class="form-section">
    <div class="form-container">
      <div class="form-header">
        <h2>Crear Cuenta</h2>
        <p>Completa los datos para comenzar</p>
      </div>

      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="auth-form">
        <!-- First Name Input -->
        <div class="input-group">
          <ion-item
            lines="none"
            class="modern-input"
            [class.has-error]="getFieldError('firstName')"
            [class.has-focus]="firstNameFocused()"
            [class.has-value]="registerForm.get('firstName')?.value"
          >
            <ion-icon name="person-outline" slot="start" color="medium"></ion-icon>
            <ion-input
              type="text"
              formControlName="firstName"
              placeholder="Tu nombre"
              (ionFocus)="firstNameFocused.set(true)"
              (ionBlur)="firstNameFocused.set(false)"
              fill="outline"
            ></ion-input>
          </ion-item>
          <div class="error-text" *ngIf="getFieldError('firstName')">
            <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
            {{ getFieldError('firstName') }}
          </div>
        </div>

        <!-- Last Name Input -->
        <div class="input-group">
          <ion-item
            lines="none"
            class="modern-input"
            [class.has-error]="getFieldError('lastName')"
            [class.has-focus]="lastNameFocused()"
            [class.has-value]="registerForm.get('lastName')?.value"
          >
            <ion-icon name="people-outline" slot="start" color="medium"></ion-icon>
            <ion-input
              type="text"
              formControlName="lastName"
              placeholder="Tus apellidos"
              (ionFocus)="lastNameFocused.set(true)"
              (ionBlur)="lastNameFocused.set(false)"
              fill="outline"
            ></ion-input>
          </ion-item>
          <div class="error-text" *ngIf="getFieldError('lastName')">
            <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
            {{ getFieldError('lastName') }}
          </div>
        </div>

        <!-- Email Input -->
        <div class="input-group">
          <ion-item
            lines="none"
            class="modern-input"
            [class.has-error]="getFieldError('email')"
            [class.has-focus]="emailFocused()"
            [class.has-value]="registerForm.get('email')?.value"
          >
            <ion-icon name="mail-outline" slot="start" color="medium"></ion-icon>
            <ion-input
              type="email"
              formControlName="email"
              placeholder="tu@email.com"
              (ionFocus)="emailFocused.set(true)"
              (ionBlur)="emailFocused.set(false)"
              fill="outline"
            ></ion-input>
          </ion-item>
          <div class="error-text" *ngIf="getFieldError('email')">
            <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
            {{ getFieldError('email') }}
          </div>
        </div>

        <!-- Password Input -->
        <div class="input-group">
          <ion-item
            lines="none"
            class="modern-input"
            [class.has-error]="getFieldError('password')"
            [class.has-focus]="passwordFocused()"
            [class.has-value]="registerForm.get('password')?.value"
          >
            <ion-icon name="lock-closed-outline" slot="start" color="medium"></ion-icon>
            <ion-input
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="password"
              placeholder="Mínimo 6 caracteres"
              (ionFocus)="passwordFocused.set(true)"
              (ionBlur)="passwordFocused.set(false)"
              fill="outline"
            ></ion-input>
            <ion-button slot="end" fill="clear" size="small" (click)="togglePasswordVisibility()">
              <ion-icon [name]="showPassword() ? 'eye-off-outline' : 'eye-outline'" color="medium"></ion-icon>
            </ion-button>
          </ion-item>
          <div class="error-text" *ngIf="getFieldError('password')">
            <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
            {{ getFieldError('password') }}
          </div>
        </div>

        <!-- Confirm Password Input -->
        <div class="input-group">
          <ion-item
            lines="none"
            class="modern-input"
            [class.has-error]="getFieldError('confirmPassword')"
            [class.has-focus]="confirmPasswordFocused()"
            [class.has-value]="registerForm.get('confirmPassword')?.value"
          >
            <ion-icon name="lock-open-outline" slot="start" color="medium"></ion-icon>
            <ion-input
              [type]="showConfirmPassword() ? 'text' : 'password'"
              formControlName="confirmPassword"
              placeholder="Confirma tu contraseña"
              (ionFocus)="confirmPasswordFocused.set(true)"
              (ionBlur)="confirmPasswordFocused.set(false)"
              fill="outline"
            ></ion-input>
            <ion-button slot="end" fill="clear" size="small" (click)="toggleConfirmPasswordVisibility()">
              <ion-icon [name]="showConfirmPassword() ? 'eye-off-outline' : 'eye-outline'" color="medium"></ion-icon>
            </ion-button>
          </ion-item>
          <div class="error-text" *ngIf="getFieldError('confirmPassword')">
            <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
            {{ getFieldError('confirmPassword') }}
          </div>
        </div>

        <!-- Terms and Conditions -->
        <div class="terms-section">
          <ion-item lines="none" class="terms-item">
            <ion-checkbox slot="start" formControlName="acceptTerms"></ion-checkbox>
            <ion-label class="terms-text">
              Acepto los
              <ion-button fill="clear" size="small" color="primary"> términos y condiciones </ion-button>
            </ion-label>
          </ion-item>
          <div class="error-text" *ngIf="getFieldError('acceptTerms')">
            <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
            {{ getFieldError('acceptTerms') }}
          </div>
        </div>

        <!-- Register Button -->
        <ion-button
          expand="block"
          type="submit"
          [disabled]="registerForm.invalid || isLoading()"
          class="primary-button"
          size="large"
        >
          <ion-icon *ngIf="!isLoading()" name="person-add-outline" slot="start"></ion-icon>
          <ion-spinner *ngIf="isLoading()" name="crescent" slot="start"></ion-spinner>
          {{ isLoading() ? 'Creando cuenta...' : 'Crear Cuenta' }}
        </ion-button>

        <!-- Divider -->
        <div class="divider">
          <span>o</span>
        </div>

        <!-- Login Link -->
        <div class="auth-link">
          <span>¿Ya tienes cuenta?</span>
          <ion-button fill="clear" color="primary" (click)="goToLogin()" class="link-button">
            Inicia sesión aquí
          </ion-button>
        </div>
      </form>
    </div>
  </div>

  <!-- Back Button -->
  <ion-fab vertical="top" horizontal="start" slot="fixed">
    <ion-fab-button size="small" color="light" (click)="goToLanding()">
      <ion-icon name="chevron-back-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
